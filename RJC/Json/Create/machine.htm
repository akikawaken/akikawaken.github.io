<!DOCTYPE html>
<html>
<head>
    <title>Rtm_Json_Creator - MachineJson</title>
    <meta charset=utf-8>
    <meta name="author" content="akikawa9616" />
    <meta name="description" content="RealTrainMod向けJson作成支援ツール:RtmJsonCreatorのブラウザ版 - machine" />
    <link rel="stylesheet" href="../../css/all-mode.css" />
    <!--JavaScript-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <noscript>
        <h1 color="red">注意: JavaScriptが無効化されています。</h1>
        <h2 color="red">Jsonの作成はJavaScriptを必須とします。</h2>
        <h2 color="red">JavaScriptの有効化方法は利用しているブラウザの利用案内を参照してください。</h2>
        <hr>
    </noscript>
    <h1>設置物の json を作成します</h1>
    <button id="back">←前ページに戻る</button> <a href="../index.html">←Indexに戻る</a>
    <script>
        document.getElementById("back").addEventListener("click", () => {
        history.back();
        });
    </script>
    <hr>
    <form id="form" onsubmit="event.preventDefault();">
        <label for="name">nameを決めてください。 使用可能:半角英数字(英語は小文字のみ可能)</label><br>
        <input type="text" id="name" name="name"><br><br>
        <label for="tags">tagsを決めてください。 使用可能:半角英数字(英語は小文字のみ可能)と","<br>複数指定する場合は","で区切って入力してください。(例:tag1,tag2,tag3)</label><br>
        <input type="text" id="tags" name="tags"><br><br>

        <label for="isSingleTrain">設置物の種類を決めてください。</label><br>
        <input type="radio" id="isSingleTrainGate" name="isSingleTrain" value="Gate">
        <label for="isSingleTrainGate">遮断機</label><br>
        <input type="radio" id="isSingleTrainPoint" name="isSingleTrain" value="Point">
        <label for="isSingleTrainPoint">転轍機</label><br>
        <input type="radio" id="isSingleTrainTurnstile" name="isSingleTrain" value="Turnstile">
        <label for="isSingleTrainTurnstile">改札機</label><br>
        <input type="radio" id="isSingleTrainVendor" name="isSingleTrain" value="Vendor">
        <label for="isSingleTrainVendor">券売機</label><br>
        <input type="radio" id="isSingleTrainLight" name="isSingleTrain" value="Light">
        <label for="isSingleTrainLight">照明(機能あり)</label><br>
        <input type="radio" id="isSingleTrainBumpingPost" name="isSingleTrain" value="BumpingPost">
        <label for="isSingleTrainBumpingPost">車止め</label><br>
        <input type="radio" id="isSingleTrainAntenna_Send" name="isSingleTrain" value="Antenna_Send">
        <label for="isSingleTrainAntenna_Send">ATC</label><br>
        <input type="radio" id="isSingleTrainAntenna_Receive" name="isSingleTrain" value="Antenna_Receive">
        <label for="isSingleTrainAntenna_Receive">列車検出器(Train detector)</label><br>

        <input type="radio" id="isSingleTrainLamp" name="isSingleTrain" value="Lamp">
        <label for="isSingleTrainLamp">照明(機能なし)</label><br>
        <input type="radio" id="isSingleTrainStair" name="isSingleTrain" value="Stair">
        <label for="isSingleTrainStair">階段</label><br>
        <input type="radio" id="isSingleTrainScaffold" name="isSingleTrain" value="Scaffold">
        <label for="isSingleTrainScaffold">足場</label><br>
        <input type="radio" id="isSingleTrainPoint" name="isSingleTrain" value="Pole">
        <label for="isSingleTrainPole">架線柱</label><br>
        <input type="radio" id="isSingleTrainPoint" name="isSingleTrain" value="Pipe">
        <label for="isSingleTrainPipe">パイプ</label><br>
        <input type="radio" id="isSingleTrainPoint" name="isSingleTrain" value="Plant">
        <label for="isSingleTrainPlant">植物</label><br><br>

        <label for="modelfile">modelを決めてください。 設置物の3Dモデルのファイル名を"拡張子あり"で入力してください。</label><br>
        <input type="text" id="modelfile" name="modelfile"><br><br>
        <h2>材質設定</h2>
        <button type="button" onclick="addTrainMat()">材質を追加</button>
        <button type="button" onclick="removeTrainMat()">最後の材質を削除</button>

        <div id="trainMatSettings"></div>
<hr>
        <label for="buttontexture">buttontextureを決めてください。<br>車輌選択画面のボタンのテクスチャへのパスを記述してください。(普通であれば、 textures/train/button_train.png などになります。)</label><br>
        <input type="text" id="buttontexture" name="buttontexture"><br><br>
        <label for="smoothing">smoothingを決めてください。</label><br>
        <input type="text" id="smoothing" name="smoothing"><br><br>
        <label for="doCulling">doCullingを決めてください。</label><br>
        <input type="text" id="doCulling" name="doCulling"><br><br>
        
        <button onclick="outputMats()">出力</button><br><br><button id="download">Download Json</button>

    </form>
    <hr>
    <h2 id="filename">------ファイル名:ModelMachine_.json-------</h2>

    <pre id="output"></pre>
    <script>
    document.getElementById("download").addEventListener("click", downloadJson);

function downloadJson() {
    var jsonString = document.getElementById("output").innerText;
    var name = document.getElementById("name").value;
    download(jsonString, 'ModelMachine_' + name + '.json', 'application/json');
}

function download(content, fileName, contentType) {
    var a = document.createElement("a");
    var file = new Blob([content], {type: contentType});
    a.href = URL.createObjectURL(file);
    a.download = fileName;
    a.click();
}

    // 列車材質設定
function addTrainMat() {
    var count = $('#trainMatSettings').children().length + 1;
    var matSetting = $('<div>').attr('id', 'trainMat' + count);
    matSetting.append($('<strong>').text("列車の3Dモデルの材質," + count + "つめの名前を決めてください。"));
    matSetting.append($('<p>').text("材質名を入力してください。"));
    matSetting.append($('<input>').attr('type', 'text').attr('class', 'trainMat'));
    matSetting.append($('<p>').text("テクスチャへのパスを記述してください。"));
    matSetting.append($('<input>').attr('type', 'text').attr('class', 'trainMatTexture'));
    matSetting.append($('<p>').text("オプションをつけますか? 使用可能: \"AlphaBlend\" , \"Light\" , \"AlphaBlend,Light\" , \"OneTex\" "));
    var options = ["AlphaBlend", "Light", "AlphaBlend,Light", "OneTex", "なし"];
    for (var j = 0; j < options.length; j++) {
      matSetting.append($('<input>').attr('type', 'radio').attr('class', 'trainMatOption').attr('name', 'trainMatOption' + count).attr('value', options[j]));
      matSetting.append($('<label>').attr('for', 'trainMatOption' + count).text(options[j]));
    }
    $('#trainMatSettings').append(matSetting);
}

        function removeTrainMat() {
            var count = $('#trainMatSettings').children().length;
            if (count > 0) {
                $('#trainMat' + count).remove();
            }
        }

        // 出力
        function outputMats() {
            var output = "{ \n";
            var name = $('#name').val();
            output += ' "name": "' + name + '", \n';

            var tags = $('#tags').val();
            output += ' "tags": "' + tags + '", \n';
            
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Gate") {
                    output += ' "machineType": "Gate",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Point") {
                    output += ' "machineType": "Point",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Turnstile") {
                    output += ' "machineType": "Turnstile",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Light") {
                    output += ' "machineType": "Light",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "BumpingPost") {
                    output += ' "machineType": "BumpingPost",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Antenna_Send") {
                    output += ' "machineType": "Antenna_Send",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Antenna_Receive") {
                    output += ' "machineType": "Antenna_Receive",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Lamp") {
                    output += ' "ornamentType": "Lamp",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Stair") {
                    output += ' "ornamentType": "Stair",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.ornamentType == "Scaffold") {
                    output += ' "ornamentType": "Scaffold",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Pole") {
                    output += ' "ornamentType": "Pole",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Pipe") {
                    output += ' "ornamentType": "Pipe",\n';
                }
            var isSingleTrainRadio = document.querySelector('input[name="isSingleTrain"]:checked');
                if (isSingleTrainRadio.value == "Plant") {
                    output += ' "ornamentType": "Plant",\n';
                }

            output += ' "model":{ \n';
            
            var modelfile = $('#modelfile').val();
            output += '  "modelFile": "' + modelfile + '", \n';

            output += '  "textures":[ \n';
            var count = $('#trainMatSettings').children().length;

        for (var i = 1; i <= count; i++) {
          var trainMat = $('#trainMat' + i + ' .trainMat').val();
          var trainMatTexture = $('#trainMat' + i + ' .trainMatTexture').val();
          var trainMatOptionRadio = document.querySelector('input[name="trainMatOption' + i + '"]:checked');
           var trainMatOption = trainMatOptionRadio ? (trainMatOptionRadio.value === "なし" ? "" : trainMatOptionRadio.value) : "";
         if (i == count) {
           output += '   ["' + trainMat + '", "' + trainMatTexture + '", "' + trainMatOption + '"] \n  ] \n }, \n';
           } else {
           output += '   ["' + trainMat + '", "' + trainMatTexture + '", "' + trainMatOption + '"],\n';
           }
        }

            var smoothing = document.getElementById('smoothing').value
            output += ' "smoothing":' + smoothing + ', \n';
            
            var doCulling = document.getElementById('doCulling').value
            output += ' "doCulling":' + doCulling + ', \n';

            var buttontexture = $('#buttontexture').val();
            output += ' "buttontexture": "' + buttontexture + '" \n';

            output += "}";
            

            document.getElementById('output').textContent = output;
            
            $('#output').text(output);
            document.getElementById("filename").innerHTML = "------ファイル名:ModelMachine_" + name + ".json-------";
        }
    </script>

</body>
</html>